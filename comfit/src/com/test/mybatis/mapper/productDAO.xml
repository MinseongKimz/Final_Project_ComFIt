<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ○ mapper 엘리먼트의 『namespace="패키지 경로가 포함된 인터페이스"』 -->
<!--    - 인터페이스 내부에 <<메소드명>>이 선언되어 있어야 한다. -->
<!--    - 이 ★<<메소드 명과 id="식별자"가 일치>>★해야 한다 -->
<mapper namespace="com.test.mybatis.IProduct">

	<!-- ○ 『id="식별자"』 속성 추가 -->
	<!--     - 인터페이스에 선언된 메소드의 이름과 일치해야 하며 -->
	<!--     호출 메소드명 역할을 수행하게 된다. -->
	
	<!-- ○ 『resultType="패키지 경로가 포함된 자료형 클래스"』 속성 추가 -->
	<!--    - string : java.lang.String
	        - byte : java.lang.Byte
	        - long : java.lang.Long
	        - short : java.lang.Short
	        - int : java.lang.Integer
	        - Integer : java.lang.Integer
	        - double : java.lang.Double
	        - float : java.lang.Float
	        - boolean : java.lang.Boolean
	        - decimal : java.math.BigDecimal
	        - Object : java.lang.Object
	        - map : java.util.Map
	        - hashmap : java.util.HashMap
	        - list : java.lang.List
	        - arraylist : java.util.Arraylist
	        - collection : java.util.Collection
	        - iterator : java.util.Iterator
	-->
	
	<!-- ○ 쿼리 내부에 있는 컬럼명의 정보가 -->
	<!--    자료형 클래스(DTO) 멤버 변수(속성)와 일치하는 경우 -->
	<!--    <<자동 매핑>>이 이루어진다. -->
	<!--    또한 SQL 문 내부에 세미콜론(;) 이 있으면 안된다. -->
	<select id="pdList" resultType="com.test.mybatis.ProductDTO">
		  SELECT V.PD_ID AS PD_ID, V.PD_NAME AS PD_NAME, V.PRICE AS PRICE, V.DISTANCE AS DISTANCE
			FROM
			(
			SELECT PD_ID, PD_NAME, PRICE
			     , ROUND(DISTANCE_WGS84(LAT, LON, #{lat}, #{lon}), 2) AS DISTANCE
			FROM DIRE_PD_NEAR_VIEW
			) V
			ORDER BY V.DISTANCE
	</select>
	<select id="cateList" resultType="com.test.mybatis.CategoryDTO">
		SELECT PD_CATEGORY_ID, CATEGORY_NAME
		FROM PRODUCT_CATEGORY
	</select>

	
	<select id="drPdList" resultType="com.test.mybatis.DirectProductDTO">
		SELECT PD_ID, PD_TITLE, PD_NAME, PD_PHOTO, PD_AS_REMAIN, PD_HITCOUNT, PRICE
		     , SUBSTR(TO_CHAR(PD_HOPE_SDATE), 1, 10) AS PD_HOPE_SDATE, SUBSTR(TO_CHAR(PD_HOPE_EDATE), 1, 10) AS PD_HOPE_EDATE
		     , PD_HOPE_STIME, PD_HOPE_ETIME, PD_HOPE_PLACE
		     , PD_REGIT_DATE, PD_MAKER_ID, PD_AS_ID, PD_AS_NAME, CATEGORY_NAME, SELLER
		     , U_NICKNAME, MAKER_NAME, MAKER_NAME2, CF_PRICE, COMMENTS
		     , PD_HOPE_EDATE + ROUND(TO_NUMBER(SUBSTR(PD_HOPE_ETIME, 1, 2)-4)/24, 10) AS REMAIN_DATE
		FROM DIRE_PD_LIST_REALVIEW
		WHERE PD_ID =  #{pd_id}
	</select>
	<select id="dlPdList" resultType="com.test.mybatis.DeliveryProductDTO">
		SELECT PD_ID, PD_TITLE, PD_NAME, PD_PHOTO, PD_AS_REMAIN, PD_HITCOUNT, PRICE
		     , PD_REGIT_DATE, PD_MAKER_ID, PD_AS_ID, PD_AS_NAME, CATEGORY_NAME, SELLER
		     , U_NICKNAME, MAKER_NAME, MAKER_NAME2, CF_PRICE, COMMENTS, IMDPRICE, (PD_REGIT_DATE+5) AS REMAIN_DATE 
		FROM DELI_PD_LIST_REALVIEW
		WHERE PD_ID = #{pd_id}
	</select>
	
	<select  id="bidList" resultType="com.test.mybatis.BidListDTO">
		SELECT BID_CODE, U_NICKNAME, PRICE, BID_DATE, ADDRESS
		FROM BID_LIST_REALVIEW
		WHERE DELI_PD_ID = #{pd_id}
	</select>

	<select id="suggestList" resultType="com.test.mybatis.SuggestListDTO">
		SELECT SUGGEST_CODE, U_NICKNAME, PRICE, SUGGEST_TIME, SUGGEST_PLACE, PLACE_DETAIL, SUGGEST_DATE
	  	  FROM SUGGEST_LIST_REALVIEW
		 WHERE DIRE_PD_ID = #{pd_id}
	</select>	

	
</mapper>









